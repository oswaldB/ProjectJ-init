<div class="bg-gray-800 p-2 rounded-lg border border-gray-700">
      <!-- Basic Info Section -->
      <div class="grid grid-cols-12 gap-2 mb-4">
        <div class="col-span-4">
          <label class="block text-xs font-medium text-gray-300">Name</label>
          <input type="text" x-model="escalation.name" class="mt-0.5 w-full bg-gray-700 text-white p-1 rounded border border-gray-600">
        </div>
        <div class="col-span-2">
          <label class="block text-sm font-medium text-gray-300">Level</label>
          <select x-model="escalation.level" class="mt-1 w-full bg-gray-700 text-white p-1.5 rounded border border-gray-600">
            <option>L1</option>
            <option>L2</option>
            <option>L3</option>
            <option>L4</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-300">Asset Class</label>
          <select x-model="escalation.assetClass" class="mt-1 w-full bg-gray-700 text-white p-1.5 rounded border border-gray-600">
            <template x-for="asset in assets">
              <option :value="asset" x-text="asset"></option>
            </template><option :value="asset" x-text="asset" value="Rates">Rates</option><option :value="asset" x-text="asset" value="FX">FX</option><option :value="asset" x-text="asset" value="Credit">Credit</option><option :value="asset" x-text="asset" value="Equity">Equity</option><option :value="asset" x-text="asset" value="Commodity">Commodity</option>
          </select>
        </div>
        <div class="col-span-5">
          <label class="block text-sm font-medium text-gray-300">Site</label>
          <div class="flex space-x-2">
            <input type="text" x-model="escalation.site.name" class="mt-1 flex-1 bg-gray-700 text-white p-2 rounded border border-gray-600">
            <button @click="selectedDrawer = 0" class="mt-1 bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
              Configure Site
            </button>
          </div>
        </div>
      </div>

      <!-- Triggers Section -->
      <div class="border-t border-gray-700 pt-4">
      <div class="flex justify-between items-center mb-2">
        <h2 class="text-lg font-semibold">Triggers</h2>
        <button @click="escalation.triggers.push({
                  issueFamily:'',
                  comparisonKey:'',
                  operator:'',
                  value:'',
                  when:'',
                  template:'',
                  status: 'draft',
                  emailType_: [false, false, false],
                  tempEmails: [],
                  emailList: [],
                  emailLists: {},
                  selectedGroups: []
                })" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
          Add Trigger
        </button>
      </div>

      <div class="space-y-2">
        <template x-for="(trigger, index) in escalation.triggers" :key="index">
          <div class="bg-gray-700 p-2 rounded">
            <div class="grid grid-cols-12 gap-2">
              <div class="col-span-2">
                <label class="block text-xs font-medium text-gray-300">Issue Family</label>
                <select x-model="trigger.issueFamily" class="mt-0.5 w-full bg-gray-600 text-white p-1 rounded border border-gray-600">
                  <option value="">Select Issue Family</option>
                  <template x-for="family in issuesFamilies">
                    <option :value="family" x-text="family"></option>
                  </template>
                </select>
              </div>
              <div class="col-span-4">
                <label class="block text-xs font-medium text-gray-300">Comparison Key</label>
                <select x-model="trigger.comparisonKey" class="mt-0.5 w-full bg-gray-600 text-white p-1 rounded border border-gray-600">
                  <option value="">Select Key</option>
                  <template x-for="key in keys">
                    <option :value="key" x-text="key"></option>
                  </template>
                </select>
              </div>
              <div class="col-span-2">
                <label class="block text-xs font-medium text-gray-300">Operator</label>
                <select x-model="trigger.operator" class="mt-0.5 w-full bg-gray-600 text-white p-1 rounded border border-gray-600">
                  <option value="">Select Operator</option>
                  <option value="equals">Equals</option>
                  <option value="bigger">Bigger</option>
                  <option value="smaller">Smaller</option>
                  <option value="contains">Contains</option>
                </select>
              </div>
              <div class="col-span-4">
                <label class="block text-xs font-medium text-gray-300">Value</label>
                <input type="text" x-model="trigger.value" class="mt-0.5 w-full bg-gray-600 text-white p-1 rounded border border-gray-600">
              </div>
              <div class="col-span-6">
                <label class="block text-sm font-medium text-gray-300 mb-1">Email Configuration</label>
                <div class="space-y-1 bg-gray-800 p-2 rounded-lg">
                  <!-- Individual Email Input -->
                  <div class="space-y-1">
                    <div class="flex justify-between items-center">
                      <label class="block text-sm font-medium text-gray-300">Add Individual Emails</label>
                      <button @click="createEmailGroup" class="text-gray-300 hover:text-red-500 flex items-center gap-1" title="Create email group from selected emails">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0Z"></path>
                        </svg>
                        <span class="text-sm">Save as Group</span>
                      </button>
                    </div>
                    <div class="flex space-x-2">
                      <input type="email" x-model="trigger.tempEmail" @keyup.enter="if(trigger.tempEmail) { 
                                 if(!trigger.emailList) trigger.emailList = [];
                                 trigger.emailList.push(trigger.tempEmail); 
                                 trigger.tempEmail = ''; 
                               }" class="w-64 bg-gray-700 text-white p-1 text-sm rounded border border-gray-600" placeholder="Enter an email address">
                      <button @click="if(trigger.tempEmail) { 
                                 if(!trigger.emailList) trigger.emailList = [];
                                 trigger.emailList.push(trigger.tempEmail); 
                                 trigger.tempEmail = ''; 
                               }" class="bg-red-500 text-white px-3 py-2 rounded hover:bg-red-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                          <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
                        </svg>
                      </button>
                    </div>
                    <!-- Email Group Selection -->
                    <div x-data="{ selectedGroup: '' }" class="flex space-x-2">
                      <select x-model="selectedGroup" @change="if(selectedGroup) {
                                const group = emailGroups.find(g => g.id === selectedGroup);
                                if(group &amp;&amp; group.emails) {
                                  if(!trigger.emailList) trigger.emailList = [];
                                  group.emails.forEach(email => {
                                    if(!trigger.emailList.includes(email)) {
                                      trigger.emailList.push(email);
                                    }
                                  });
                                }
                                selectedGroup = '';
                              }" class="flex-1 bg-gray-700 text-white p-2 rounded border border-gray-600">
                        <option value="">Select an email group to import</option>
                        <template x-for="group in emailGroups" :key="group.id">
                          <option :value="group.id" x-text="group.name"></option>
                        </template>
                      </select>
                    </div>
                  </div>
                  <!-- Display Selected Emails -->
                  <div class="flex flex-wrap gap-2">
                    <template x-for="(email, index) in (trigger.emailList || [])" :key="index">
                      <div class="bg-gray-700 text-white px-3 py-1 rounded-full flex items-center gap-2">
                        <span x-text="email"></span>
                        <button @click="trigger.emailList.splice(index, 1)" class="hover:text-red-400">×</button>
                      </div>
                    </template>
                  </div>
                </div>
              </div>
              <div class="col-span-2">
                <label class="block text-xs font-medium text-gray-300">When</label>
                <select x-model="trigger.when" class="mt-0.5 w-full bg-gray-600 text-white p-1 rounded border border-gray-600">
                  <option value="">Select Time</option>
                  <option value="now">now</option>
                  <option value="now+5">now+5</option>
                  <option value="now+10">now+10</option>
                  <option value="now+15">now+15</option>
                  <option value="now+30">now+30</option>
                  <option value="now+60">now+60</option>
                </select>
              </div>
              <div class="col-span-4">
                <label class="block text-xs font-medium text-gray-300">Template</label>
                <div class="flex space-x-2">
                  <select x-model="trigger.template" class="mt-0.5 flex-1 bg-gray-600 text-white p-1 rounded border border-gray-600 text-sm">
                    <option value="">Select Template</option>
                    <template x-for="template in templates">
                      <option :value="template.id" x-text="template.name"></option>
                    </template>
                  </select>
                  <button @click="escalation.triggers.splice(index, 1)" class="mt-0.5 bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 text-sm">
                    Remove
                  </button>
                </div>
              </div>
            </div>
          </div>
        </template><div class="bg-gray-700 p-2 rounded">
            <div class="grid grid-cols-12 gap-2">
              <div class="col-span-2">
                <label class="block text-xs font-medium text-gray-300">Issue Family</label>
                <select x-model="trigger.issueFamily" class="mt-0.5 w-full bg-gray-600 text-white p-1 rounded border border-gray-600">
                  <option value="">Select Issue Family</option>
                  <template x-for="family in issuesFamilies">
                    <option :value="family" x-text="family"></option>
                  </template><option :value="family" x-text="family" value="Valuation">Valuation</option><option :value="family" x-text="family" value="Data Quality">Data Quality</option><option :value="family" x-text="family" value="System">System</option><option :value="family" x-text="family" value="Process">Process</option><option :value="family" x-text="family" value="People">People</option>
                </select>
              </div>
              <div class="col-span-4">
                <label class="block text-xs font-medium text-gray-300">Comparison Key</label>
                <select x-model="trigger.comparisonKey" class="mt-0.5 w-full bg-gray-600 text-white p-1 rounded border border-gray-600">
                  <option value="">Select Key</option>
                  <template x-for="key in keys">
                    <option :value="key" x-text="key"></option>
                  </template>
                </select>
              </div>
              <div class="col-span-2">
                <label class="block text-xs font-medium text-gray-300">Operator</label>
                <select x-model="trigger.operator" class="mt-0.5 w-full bg-gray-600 text-white p-1 rounded border border-gray-600">
                  <option value="">Select Operator</option>
                  <option value="equals">Equals</option>
                  <option value="bigger">Bigger</option>
                  <option value="smaller">Smaller</option>
                  <option value="contains">Contains</option>
                </select>
              </div>
              <div class="col-span-4">
                <label class="block text-xs font-medium text-gray-300">Value</label>
                <input type="text" x-model="trigger.value" class="mt-0.5 w-full bg-gray-600 text-white p-1 rounded border border-gray-600">
              </div>
              <div class="col-span-6">
                <label class="block text-sm font-medium text-gray-300 mb-1">Email Configuration</label>
                <div class="space-y-1 bg-gray-800 p-2 rounded-lg">
                  <!-- Individual Email Input -->
                  <div class="space-y-1">
                    <div class="flex justify-between items-center">
                      <label class="block text-sm font-medium text-gray-300">Add Individual Emails</label>
                      <button @click="createEmailGroup" class="text-gray-300 hover:text-red-500 flex items-center gap-1" title="Create email group from selected emails">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M17.593 3.322c1.1.128 1.907 1.077 1.907 2.185V21L12 17.25 4.5 21V5.507c0-1.108.806-2.057 1.907-2.185a48.507 48.507 0 0 1 11.186 0Z"></path>
                        </svg>
                        <span class="text-sm">Save as Group</span>
                      </button>
                    </div>
                    <div class="flex space-x-2">
                      <input type="email" x-model="trigger.tempEmail" @keyup.enter="if(trigger.tempEmail) { 
                                 if(!trigger.emailList) trigger.emailList = [];
                                 trigger.emailList.push(trigger.tempEmail); 
                                 trigger.tempEmail = ''; 
                               }" class="w-64 bg-gray-700 text-white p-1 text-sm rounded border border-gray-600" placeholder="Enter an email address">
                      <button @click="if(trigger.tempEmail) { 
                                 if(!trigger.emailList) trigger.emailList = [];
                                 trigger.emailList.push(trigger.tempEmail); 
                                 trigger.tempEmail = ''; 
                               }" class="bg-red-500 text-white px-3 py-2 rounded hover:bg-red-600">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                          <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd"></path>
                        </svg>
                      </button>
                    </div>
                    <!-- Email Group Selection -->
                    <div x-data="{ selectedGroup: '' }" class="flex space-x-2">
                      <select x-model="selectedGroup" @change="if(selectedGroup) {
                                const group = emailGroups.find(g => g.id === selectedGroup);
                                if(group &amp;&amp; group.emails) {
                                  if(!trigger.emailList) trigger.emailList = [];
                                  group.emails.forEach(email => {
                                    if(!trigger.emailList.includes(email)) {
                                      trigger.emailList.push(email);
                                    }
                                  });
                                }
                                selectedGroup = '';
                              }" class="flex-1 bg-gray-700 text-white p-2 rounded border border-gray-600">
                        <option value="">Select an email group to import</option>
                        <template x-for="group in emailGroups" :key="group.id">
                          <option :value="group.id" x-text="group.name"></option>
                        </template><option :value="group.id" x-text="group.name" value="emailgroups-1744721510584">mail group 1</option><option :value="group.id" x-text="group.name" value="emailgroups-1744727115269">coco</option><option :value="group.id" x-text="group.name" value="emailgroups-1744727835939">test 4</option>
                      </select>
                    </div>
                  </div>
                  <!-- Display Selected Emails -->
                  <div class="flex flex-wrap gap-2">
                    <template x-for="(email, index) in (trigger.emailList || [])" :key="index">
                      <div class="bg-gray-700 text-white px-3 py-1 rounded-full flex items-center gap-2">
                        <span x-text="email"></span>
                        <button @click="trigger.emailList.splice(index, 1)" class="hover:text-red-400">×</button>
                      </div>
                    </template>
                  </div>
                </div>
              </div>
              <div class="col-span-2">
                <label class="block text-xs font-medium text-gray-300">When</label>
                <select x-model="trigger.when" class="mt-0.5 w-full bg-gray-600 text-white p-1 rounded border border-gray-600">
                  <option value="">Select Time</option>
                  <option value="now">now</option>
                  <option value="now+5">now+5</option>
                  <option value="now+10">now+10</option>
                  <option value="now+15">now+15</option>
                  <option value="now+30">now+30</option>
                  <option value="now+60">now+60</option>
                </select>
              </div>
              <div class="col-span-4">
                <label class="block text-xs font-medium text-gray-300">Template</label>
                <div class="flex space-x-2">
                  <select x-model="trigger.template" class="mt-0.5 flex-1 bg-gray-600 text-white p-1 rounded border border-gray-600 text-sm">
                    <option value="">Select Template</option>
                    <template x-for="template in templates">
                      <option :value="template.id" x-text="template.name"></option>
                    </template><option :value="template.id" x-text="template.name" value="templates-1744665247051">escalation template</option>
                  </select>
                  <button @click="escalation.triggers.splice(index, 1)" class="mt-0.5 bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600 text-sm">
                    Remove
                  </button>
                </div>
              </div>
            </div>
          </div>
      </div>
    </div>
  </div>