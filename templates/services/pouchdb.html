<script>
async function initializePouchDB(dbName) {
  dbName = dbName || 'issuesDB'; // Default to 'issuesDB' if dbName is not defined
  const pouchDB = new PouchDB(dbName);
  try {
    // Delete the local database before initialization
    await pouchDB.destroy();

    const newPouchDB = new PouchDB(dbName);
    const apiEndpoint = dbName === 'issuesDB' 
      ? '/pc-analytics-jaffar/api/jaffar/pouchdb/init' 
      : `/pc-analytics-jaffar/api/pouchdb/init/${dbName}`;
    const response = await fetch(apiEndpoint, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
    });

    if (!response.ok) {
      throw new Error('Failed to fetch data for PouchDB initialization');
    }

    const data = await response.json();
    const chunks = data.chunks || [];

    // Add unique _id to each document for PouchDB
    let docId = 1;
    for (const chunk of chunks) {
      const docsWithIds = chunk.map(doc => ({
        _id: `doc_${docId++}`,
        ...doc
      }));
      await newPouchDB.bulkDocs(docsWithIds);
    }

    console.log(`PouchDB (${dbName}) initialized successfully`);
  } catch (error) {
    console.error(`Error initializing PouchDB (${dbName}):`, error);
  }
}
</script>