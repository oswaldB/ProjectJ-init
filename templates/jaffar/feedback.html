
{% extends "jaffar/base.html" %}

{% block title %}User Feedback{% endblock %}

{% block content %}
<div x-data="{
  ideas: [],
  newIdea: '',
  searchQuery: '',
  async init() {
    await this.loadIdeas();
  },
  async loadIdeas() {
    const response = await fetch('/api/jaffar/feedback/list');
    this.ideas = await response.json();
  },
  async submitIdea() {
    if (!this.newIdea.trim()) return;
    await fetch('/api/jaffar/feedback/submit', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ text: this.newIdea })
    });
    this.newIdea = '';
    await this.loadIdeas();
  },
  async vote(id, type) {
    await fetch('/api/jaffar/feedback/vote', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ id, type })
    });
    await this.loadIdeas();
  },
  filteredIdeas() {
    return this.ideas.filter(idea => 
      idea.text.toLowerCase().includes(this.searchQuery.toLowerCase())
    );
  }
}">
  <div class="max-w-4xl mx-auto mt-8 p-4">
    <h1 class="text-2xl font-bold mb-6">Feedback & Ideas</h1>
    
    <div class="mb-6">
      <input type="text" x-model="searchQuery" 
             class="w-full bg-gray-800 border border-gray-700 rounded p-2"
             placeholder="Search ideas...">
    </div>

    <div class="mb-6 flex gap-2">
      <input type="text" x-model="newIdea"
             class="flex-1 bg-gray-800 border border-gray-700 rounded p-2"
             placeholder="Share your idea...">
      <button @click="submitIdea()"
              class="bg-red-600 text-white px-4 py-2 rounded">
        Submit
      </button>
    </div>

    <div class="space-y-4">
      <template x-for="idea in filteredIdeas()" :key="idea.id">
        <div class="bg-gray-800 p-4 rounded-lg flex items-center gap-4">
          <div class="flex flex-col items-center gap-1">
            <button @click="vote(idea.id, 'up')"
                    class="text-gray-400 hover:text-white">▲</button>
            <span x-text="idea.votes" class="font-bold"></span>
            <button @click="vote(idea.id, 'down')"
                    class="text-gray-400 hover:text-white">▼</button>
          </div>
          <div class="flex-1">
            <p x-text="idea.text"></p>
            <p class="text-sm text-gray-400 mt-1">
              Posted by <span x-text="idea.author"></span>
              on <span x-text="new Date(idea.date).toLocaleDateString()"></span>
            </p>
          </div>
        </div>
      </template>
    </div>
  </div>
</div>
{% endblock %}
