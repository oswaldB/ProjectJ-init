<template x-if="field.type === 'ask_scheherazade'">
<div class="mb-4">

  <div x-show="field.description" class="text-sm text-gray-400 mb-2" x-text="field.description"></div>

  <div class="space-y-3">
    <!-- AI Response Display with Quill Editor -->
    <div x-show="responses && responses[field.key]" class="bg-gray-700 rounded p-3 border border-gray-600">
      <div class="flex items-center justify-between mb-2">
        <span class="text-xs text-gray-400">AI Response:</span>
      </div>
      <div class="text-white text-sm">
        <div x-ref="quillResponseElement"
             x-init="
               if (!window.quillInstances) window.quillInstances = {};
               $nextTick(() => {
                 if (!window.quillInstances[`response_${field.key}`] && $refs.quillResponseElement) {
                   const quill = new Quill($refs.quillResponseElement, {
                     theme: 'snow',
                     modules: {
                       toolbar: [
                         ['bold', 'italic', 'underline'],
                         [{'list': 'ordered'}, {'list': 'bullet'}],
                         ['link'],
                         [{'header': [1, 2, 3, false]}]
                       ]
                     }
                   });
                   
                   if (responses && responses[field.key]) {
                     quill.root.innerHTML = responses[field.key];
                   }
                   
                   quill.on('text-change', function() {
                     if (!responses) responses = {};
                     responses[field.key] = quill.root.innerHTML;
                   });
                   
                   window.quillInstances[`response_${field.key}`] = quill;
                 }
               });
             "
             class="bg-white text-black rounded border border-gray-600 min-h-[120px]">
        </div>
      </div>
    </div>

    <!-- Ask Button -->
    <button @click="askScheherazade(field)" 
            class="bg-red-600 hover:bg-red-700 disabled:bg-gray-600 text-white px-4 py-2 rounded transition-colors">
      <span x-show="!loadingStates || !loadingStates[field.key]" x-text="field.buttonLabel || 'Ask Scheherazade'"></span>
      <span x-show="loadingStates && loadingStates[field.key]" class="flex items-center">
        <svg class="animate-spin h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        Processing...
      </span>
    </button>

    <!-- Error Display -->
    <div x-show="errors && errors[field.key]" class="bg-red-500 bg-opacity-10 border border-red-500 text-red-400 px-3 py-2 rounded text-sm">
      <span x-text="errors && errors[field.key] ? errors[field.key] : ''"></span>
    </div>
  </div>
</div>
</template>