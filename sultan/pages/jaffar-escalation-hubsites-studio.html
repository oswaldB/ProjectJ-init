<!--############-->
<!--# This page hosts the chat-->
<!--# Author : @oswaldbernard-->
<!--############-->

<!--############-->
<!--# This page is a nested base.html that describe the app layout-->
<!--# it also add the alpinejs, tailwindcss and pouchdb to the project-->
<!--# Author : @oswaldbernard-->
<!--############-->
<!--working -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta content="IE=edge" http-equiv="X-UA-Compatible" />
    <meta
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
      name="viewport"
    />

    <title>Sultan</title>

    <script
      defer
      src="https://stash.hk.hsbc/projects/STRATPCJAFFAR/repos/pc-sultan/raw/apps/pc_sultan/assets/pouchdb.js"
    ></script>
    <script
      defer
      src="https://stash.hk.hsbc/projects/STRATPCJAFFAR/repos/pc-sultan/raw/apps/pc_sultan/assets/axios.js"
    ></script>
    <!-- <link rel="stylesheet" href="https://stash.hk.hsbc/projects/STRATPCJAFFAR/repos/pc-sultan/raw/apps/pc_sultan/assets/css/custom.css"> -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,container-queries"></script>
    <script>
      async function loadComponent(elementId, componentPath) {
        try {
          const response = await fetch(componentPath);
          const html = await response.text();
          document.getElementById(elementId).innerHTML = html;
        } catch (error) {
          console.error("Error loading componentn:", error);
        }
      }
    </script>
  </head>
  <body
    class="bg-black mx-auto flex min-h-screen min-w-screen bg-black"
    x-data="jaffarEscalationHubsiteStudio()"
  >
    <!-- we add the menu -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        loadComponent("menu", "../menu/menu.html");
      });
    </script>
    <div id="menu"></div>

    <!-- the content  -->
    <div class="w-full p-4 ml-[260px]" x-show="page=='hubsite-studio'">
      <div class="flex justify-between">
        <h1 class="text-white text-2xl h-4 p-2 ml-4">
          Jaffar Escalation Hubsite Studio
        </h1>
        <div class="inline-flex rounded-md shadow-sm">
          <a
            @click="window.confirm('This process will erase your local configuration. Do you confirm the import?')&& importHubsites()"
            class="bg-red-600 hover:bg-red-500 text-white px-4 py-2 text-sm font-medium rounded-s-lg focus:z-10 focus:ring-2 hover:text-black"
          >
            Import current escalation hubsites
          </a>
          <a
            @click="prepTheDataForExportJaffar()"
            class="bg-red-600 hover:bg-red-500 text-white px-4 py-2 text-sm font-medium rounded-e-lg focus:z-10 focus:ring-2 hover:text-black"
          >
            Publish the escalation hubsite
          </a>
        </div>
      </div>

      <!--    The main wrapper-->

      <div class="flex flex-row">
        <!--        The hubsite studio-->

        <!--        The group creation pannel -->
        <div
          class="p-8 bg-gray-800 m-4 min-h-screen w-full overflow-y-auto text-white"
        >
          <div class="mt-10">
             <div x-data="{filter:''}">
                            <div>
                                <div class="flex">
                                    <label
                                            class="block font-medium text-xl flex-grow"
                                    >Select hubsites</label
                                    >
                                    <form class="max-w-md mx-auto">
                                        <label class="mb-2 text-sm font-medium sr-only text-white" for="default-search">Search</label>
                                        <div class="relative">
                                            <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                                                <svg aria-hidden="true" class="w-4 h-4 text-gray-400"
                                                     fill="none" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                                    <path d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z" stroke="currentColor"
                                                          stroke-linecap="round" stroke-linejoin="round"
                                                          stroke-width="2"/>
                                                </svg>
                                            </div>
                                            <input class="block w-full p-4 ps-10 text-sm text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500" required
                                                   type="search"
                                                   x-model.debounce="filter"/>
                                        </div>
                                </div>
                                <div class="space-y-2 mt-1">
                                    <div
                                            class="w-full grid grid-cols-3 auto-cols-max gap-2 overflow-y-auto"
                                    >
                                        <template x-for="(option,index) in questions[0].options">
                                            <div class="flex items-center"
                                                 x-show="filter.length==0||option.name.toLowerCase().includes(filter.toLowerCase())">
                                                <input
                                                        @click.prevent="saveAnswer(option.name)"
                                                        :class="selectedHubsites.hubsites.includes(option.name)&&'bg-red-600 border-red-900'"
                                                        class="h-4 w-4"
                                                        name="services"
                                                        type="checkbox"
                                                />
                                                <label
                                                        class="ml-2 text-sm font-medium"
                                                        x-text="option.name"
                                                >ALCM</label
                                                >
                                            </div>
                                        </template>
                                    </div>
                                </div>
                            </div>
                        </div>
        </div>
      </div>
    </div>
</div>

      <!--start the export to jaffar -->
      <div class="w-screen p-4 ml-[260px]" x-show="page=='export-to-jaffar'">
        <div class="flex justify-between">
            <h1 class="text-white text-2xl h-4 p-2 ml-4">Jaffar Questions Studio</h1>
            <div class="inline-flex rounded-md shadow-sm justify-end ">
                <a @click="page='template-studio'"
                   class="bg-red-600 hover:bg-red-500 text-white px-4 py-2 text-sm font-medium rounded-lg focus:z-10 focus:ring-2">
                    Return to edition
                </a>
            </div>
        </div>


        <!--        Import config file-->

        <div class="grid grid-cols-3 gap-10">
            <div class="m-4 h-screen col-span-2 w-full overflow-y-auto bg-gray-800 p-8 ">
                <h2 class="mb-3 text-xl font-medium text-white ">Export the Jaffar config file</h2>
                <div>
                    <div>
                    <textarea
                            class=" min-h-[85vh] mt-1 w-full px-4 py-2 bg-gray-900 border border-gray-600 rounded-lg focus:ring-red-500 focus:border-red-500 text-white"
                            disabled row="20" type="textarea" x-model="jaffarConfigExport"></textarea>
                    </div>
                </div>
            </div>

            <div class="m-4 h-screen  w-full overflow-y-auto bg-gray-800 p-8 text-white">
                <h2 class="mb-3 text-xl font-medium text-white">How to use me?</h2>
                <ul class="space-y-2">
                    <li> 1. Copy this code <span @click="navigator.clipboard.writeText(jaffarConfigExport)"
                                                 class="bg-red-600 hover:bg-red-500 text-white px-4 py-2 ml-4 text-sm font-medium rounded-lg focus:z-10 focus:ring-2">Copy
                        it</span></li>
                    <li> 2. Send it to oswald.bernard@hsbc.com, emilia.m.kaleta-pazdur@hsbc.com,
                        rafal.muszynski@hsbcib.com with the object: NEW JAFFAR DIRECTORIES
                    </li>
                    <li>
                        <a class="bg-red-600 hover:bg-red-500 text-white px-4 py-2 text-sm font-medium rounded-lg focus:z-10 focus:ring-2"
                           href="mailto:oswald.bernard@hsbc.com;emilia.m.kaleta-pazdur@hsbc.com;rafal.muszynski@hsbcib.com?subject=NEW%20JAFFAR%20DIRECTORIES">Send
                            now</a>
                    </li>
                </ul>
            </div>

        </div>


    </div>



    <script defer src="../menu/menu.js"></script>
    <script defer src="./jafar-escalation-hubsites-studio.js"></script>
    <script
      defer
      src="https://stash.hk.hsbc/projects/STRATPCJAFFAR/repos/pc-sultan/raw/apps/pc_sultan/assets/mask-alpine.js"
    ></script>
    <script
      defer
      src="https://stash.hk.hsbc/projects/STRATPCJAFFAR/repos/pc-sultan/raw/apps/pc_sultan/assets/alpine.js"
    ></script>
  </body>
</html>
